<div class="modal fade" id="idResetPassword">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content " style="border-radius: 10px !important;">
       
            <!-- Select EMAIL or SMS--> 
			<div id="idResetPasswordStep1" class="card mt-0 " style="border-radius: 10px !important;color:#0C0C0C!important;">
				<div class="card-footer bg-primary text-center text-White"  style="border-top-left-radius: 10px !important;border-top-right-radius: 10px !important;">
					<h5>Forgot Password <button type="button" class="close closedialog"  data-dismiss="modal">&times;</button></h5>
				</div>
				<div class="card-body bg-gray94" style="border-bottom-left-radius: 10px !important;border-bottom-right-radius: 10px !important;">
					<form>
						<div class="form-group text-center mt-1">
						<img class="rounded-circle" style="height:60px;width:auto;" src="https://storage.cloud.google.com/imagelib/profileimage/defaultprofile.png" alt="" id="profileimage" name="profileimage">
						</div>   
						<div class="form-group text-center mt-0">
                        <h5 id="idResetPasswordName">name</h5>
						</div>
						<div class="form-group text-center mt-2">
						<p>Select email/mobile number for OTP code.</p>
						</div>                               

						<div class="row mx-3 no-gutters" id="emailpart" name="emailpart">
							<div class="col-sm-3">
							<div class="custom-control custom-checkbox mt-2" >
								<input class="form-check-input" type="radio" name="resetpasswordOption" id="resetpasswordOptionEmailOpt" value="email">
								<label class="form-check-label" for="resetpasswordOptionEmail">Email</label>
							</div>            
							</div>     
							<div class="col-sm-9">
								<input type="text" class="form-control rounded-pill disabled-bgcolorwhite" id="idResetPasswordEmailText" disabled>
							</div>
						</div>
						<div class="row mx-3 mt-3 no-gutters"  id="smspart" name="smspart">
							<div class="col-sm-3">
							<div class="custom-control custom-checkbox mt-2" >
								<input class="form-check-input" type="radio" name="resetpasswordOption" id="resetpasswordOptionSMS" value="sms" >
								<label class="form-check-label" for="resetpasswordOptionSMS">SMS</label>
							</div>            
							</div>     
							<div class="col-sm-9 ">
								<input type="text" class="form-control rounded-pill disabled-bgcolorwhite"  id="idResetPasswordSmsText" disabled>
							</div>
						</div>
						<div class="form-group mt-4 mb-0 mx-3">
							<a class="btn btn-primary w-100 rounded-pill" href="javascript:void(0)" onclick="resetpassword_sendotp();">submit</a>
						</div>
                        <div class="form-group align-items-center mt-4 mb-0">
							<p class="text-center" >Need help? 
                            <a class="text-primary" style="text-shadow: 1px 1px 8px #FFFFFF;" href="javascript:void(0)" onclick="alert('Will link');">Knowledge Base!</a>
                            </p>
						</div>
					</form>
                    
				</div>
			</div>
            <!-- Enter OTP-->
			<div id="idResetPasswordStep2" class="card mt-0 " style="display:none;border-radius: 10px !important;color:#0C0C0C!important;">
				<div class="card-footer bg-primary text-center text-White"  style="border-top-left-radius: 10px !important;border-top-right-radius: 10px !important;">
					<h5>Confirm OTP<button type="button" class="close closedialog"  data-dismiss="modal">&times;</button></h5>
				</div>
				<div class="card-body bg-gray94" style="border-bottom-left-radius: 10px !important;border-bottom-right-radius: 10px !important;">
					<form>
						<div class="form-group text-center mt-2">
						<p  id="idResetPasswordStep2msg">OTP has been sent to your email/SMS.</p>
						</div>              
						<div class="row mx-3 no-gutters mt-3">
							<div class="col-sm-4 mt-2">
								<p>OTP Code</p>          
							</div>     
							<div class="col-sm-8">
								<input type="text" id="idResetPasswordStep2OtpCodeText"  class="form-control rounded-pill">
							</div>
						</div>
						<div class="form-group d-flex align-items-center justify-content-center mt-4 mb-0">
							<a class="btn btn-primary w-100 rounded-pill" href="javascript:void(0)" onclick="resetpassword_verify()">verify</a>
						</div>
                        <div class="form-group d-flex align-items-center justify-content-center mt-4 mb-0">
							<p class="text-center" >Do not receive code?
                            <a class="text-primary" id="resendcode" name="resendcode" style="text-shadow: 1px 1px 8px #FFFFFF;" href="javascript:void(0)" onclick="resetpassword_sendotp();">Resend code</a>
                           </p>
						</div>
                        <div class="form-group d-flex align-items-center justify-content-center mt-4 mb-0">
                           <i class="far fa-clock" id='timer' name='timer'></i>
						</div>
					</form>                    
				</div>
			</div>
            <!-- Enter Your New Password-->
			<div id="idResetPasswordStep3" class="card mt-0 " style="display:none;border-radius: 10px !important;color:#0C0C0C!important;">
				<div class="card-footer bg-primary text-center text-White"  style="border-top-left-radius: 10px !important;border-top-right-radius: 10px !important;">
					<h5>New Password<button type="button" class="close closedialog"  data-dismiss="modal">&times;</button></h5>
				</div>
				<div class="card-body bg-gray94" style="border-bottom-left-radius: 10px !important;border-bottom-right-radius: 10px !important;">
					<form>
						<div class="form-group text-center mt-2">
						<p>Please enter your new password.</p>
						</div>              
						<div class="row mx-3 no-gutters mt-3">
							<div class="col-sm-4 mt-2">
								<p>New Password</p>          
							</div>     
							<div class="col-sm-8">
								<input id="idResetPasswordStep3New"  title="Password should contain atleast one special char, one number, one capital letter" name="idResetPasswordStep3New" minlength="8"  maxlength="10" type="password" class="form-control rounded-pill strongePassword ">
							</div>
						</div>
						<div class="row mx-3 no-gutters mt-3">
							<div class="col-sm-4 mt-2">
								<p>Confirm Password</p>          
							</div>     
							<div class="col-sm-8">
								<input id="idResetPasswordStep3Confirm" type="password" minlength="8"  maxlength="10" class="form-control rounded-pill">
							</div>
						</div>
						<div class="form-group d-flex align-items-center justify-content-center mt-4 mb-0">
							<a class="btn btn-primary w-100 rounded-pill" href="javascript:void(0)" onclick="new_password()">submit</a>
						</div>
                        <div class="form-group d-flex align-items-center justify-content-center mt-4 mb-0">
							<p class="text-center" >Need help?
                            <a class="text-primary" style="text-shadow: 1px 1px 8px #FFFFFF;" href="javascript:void(0)" onclick="alert('Will link');">Knowledge base</a>
                            </p>
						</div>
					</form>                    
				</div>
			</div>
		</div>
	</div>
</div>
 
<script>


var pResetPasswordUserId;
var pResetPasswordOtpCode;
var pResetPasswordSession;
var pResetPasswordotptypeemail;
var pResetPasswordotptypesms;
var pResetPasswordname;

function resetPasswordOpen(data){

    

  pResetPasswordUserId = data.data[0].userid;
  pResetPasswordOtpCode = data.data[0].otpcode;
  pResetPasswordSession = data.data[0].sessionid;
  pResetPasswordotptypeemail = data.data[0].email;
  pResetPasswordotptypesms = data.data[0].phone;
   pResetPasswordname =data.data[0].name;
document.getElementById("idResetPasswordName").innerHTML = data.data[0].name;
$('#profileimage').attr('src', data.data[0].profileimage)

if((data.data[0].email =='' || data.data[0].email ==null) && ( data.data[0].phone =='' || data.data[0].phone ==null))
{
			toastboxOpen("2010"); 
                $('#idResetPassword').modal('hide');  

}
else
{
$('#idResetPassword').modal({
     backdrop: 'static',
     keyboard: false
    });
  if ((data.data[0].email).length > 0  && data.data[0].email!='' && data.data[0].email!=null) {
  $('#idResetPasswordEmailText').val( maskEmail(data.data[0].email)  );
    $('#emailpart').show();
  $("#resetpasswordOptionEmailOpt").prop("checked", true);
  } 
  else { 
  document.getElementById("resetpasswordOptionEmailOpt").disabled = true;
      $('#emailpart').hide();
  }
  
  if ((data.data[0].phone).length > 0  && data.data[0].phone!='' && data.data[0].phone!=null) {
  $('#idResetPasswordSmsText').val( maskPhoneNo(data.data[0].phone)  );
  $('#smspart').show();
    $("#resetpasswordOptionSMS").prop("checked", true);
  }
  else
  {
  $('#smspart').hide();
  }
    $('#idResetPassword').modal('show');  

  }
}
function resetPasswordClose(){  
  $('#idResetPassword').modal('hide');  
}
</script>

<script>
function maskEmail(txt){
 var s = txt.split("@"); //split email add
 var l = s[0].length; //length email id
 var f = s[0].substring(0,1); //email first letter
 var d = s[1]; //email domain;
 return f + "*".repeat(l) + "@" + d;
}
function maskPhoneNo(txt){
  var l = txt.length;
  var f = txt.substring(0,3); //email first letter
  var e = txt.substring(l-2); //email end letter
  return f + "*".repeat(l-5) + e;
}

var timer;
function myTimer() {
    var sec = 15
    clearInterval(timer);
    timer = setInterval(function() { 
    $('#timer').text(sec--).show();
    if (sec == -1) {
      clearInterval(timer);
//           $('#timer').hide();
$("#resendcode a").removeClass('disabled');

           
     } 
    }   , 1000);

}

 
//$(document).on("blur",'.strongePassword', function (){
//var getpass=$("#idResetPasswordStep3New").val();
//alert(getpass.replace(/^(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])[a-zA-Z0-9!@#$%&*]+$/))
//        return getpass.replace(/^(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])[a-zA-Z0-9!@#$%&*]+$/);
//    });
    
    

    $(".strongePassword").blur(function () {
    strongePassword();
    });
    function strongePassword()
    {
var _val=$("#idResetPasswordStep3New").val();
	var _pattern = /^(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])[a-zA-Z0-9!@#$%&*]+$/;
    var _getresult=$.trim(_val).match(_pattern) ? true : false;
    
    var _result=false;
    if(_getresult == true &&  _val.length >8)
    {
    _result=true;
    }
    else
    {
    if(_getresult == false)
    {
    			toastboxOpen("2011"); 
    }
    else if(_val.length <8)
    {
    			toastboxOpen("2012"); 

    }
    }
	return _result;
}
</script>

<script>

function resetpassword_sendotp(){
    var _radioValue = $("input[name='resetpasswordOption']:checked").val();
    if(_radioValue == 'email')
    {
    progressboxOpen(); 
			google.script.run
			.withFailureHandler(ihaveerror)
			.withSuccessHandler(enterotphere)
            .executereset({"action" : "send_otp","param":{"value" : pResetPasswordotptypeemail,"userid" : pResetPasswordUserId, "type" : "email" ,"createby":pResetPasswordname}});
    }
    else
      if(_radioValue == 'sms')
    {
    progressboxOpen(); 
    google.script.run
			.withFailureHandler(ihaveerror)
			.withSuccessHandler(enterotphere)
            .executereset({"action" : "send_otp","param":{"value" : pResetPasswordotptypesms,"userid" : pResetPasswordUserId, "type" : "mobile" ,"createby":pResetPasswordname}});
    }
    

$("#resendcode a").addClass('disabled');

myTimer()
//alert(document.getElementById("resetpasswordOptionSMS").checked)
//    if (document.getElementById("resetpasswordOptionSMS").checked == false) {
//      document.getElementById("idResetPasswordStep2msg").innerHTML = "OTP has been sent to your email."; 
//    } else {
//      document.getElementById("idResetPasswordStep2msg").innerHTML = "OTP has been sent to your mobile number."; 
//    }
//    document.getElementById("idResetPasswordStep2").style.display='block';
//    document.getElementById("idResetPasswordStep1").style.display='none';
//    google.script.run.runAPI({"action" : "sent_otp","param":{"userid" : pResetPasswordUserId, "sent" : "sms" }}); //Unlocked
}


function enterotphere(data)
{
progressboxClose(); 
pResetPasswordOtpCode=data.data[0]["OTP"];
if(data.result['code'] == 3000)
{
$("#idResetPasswordStep2").show();
$("#idResetPasswordStep1").hide();
$("#idResetPasswordStep2 *").val('');
}
else
{
$("#idResetPasswordStep2").hide();
$("#idResetPasswordStep1").show();

}



}

</script>
<script>
function resetpassword_verify(){
   var _inpcode=$("#idResetPasswordStep2OtpCodeText").val(); 
   var _otpcode=pResetPasswordOtpCode;
   if (_inpcode !== "" ) {
      var _params = {"otpcode" : _otpcode, "inputcode": _inpcode};           
			google.script.run
			.withSuccessHandler(resetpassword_verifyOK)
			.verify_otp(_params);  
	} else {
			toastboxOpen("1003"); 
	} 
}
function resetpassword_verifyOK(data){
  if (data.verify == true){
      $("#idResetPasswordStep3").show();
      $("#idResetPasswordStep2").hide();
            $("#idResetPasswordStep1").hide();
          $('#idResetPassword').modal('show');  

if(pResetPasswordOtpCode == undefined)
{
            pResetPasswordUserId = data.userid;
   pResetPasswordname =data.name;
  pResetPasswordSession = data.sessionid;
}
          


    $("#idResetPasswordStep3 *").val('');
  } else {
			toastboxOpen("2004"); 
  } 
  
}
</script>

<script>
function new_password(){
	if (navigator.onLine=true) {    
		var _new=$("#idResetPasswordStep3New").val(); 
		var _confirm=$("#idResetPasswordStep3Confirm").val();  
        var _userid = pResetPasswordUserId;
        var _sessionid = pResetPasswordSession;
		var _params;
        
         
        

		if  (_new.length > 0 && _confirm.length > 0)  {

           if  (_new == _confirm)  {
                _params = {	"action" : "update_password",
			"param"  : {
                  "userid" : _userid,
			"newpassword" :  _new,
            "sessionid" : _sessionid,
			"createby":pResetPasswordname}
            };
            

            var _result=strongePassword();

            if(_result == true)
            {
			progressboxOpen();            
			google.script.run
			.withFailureHandler(new_passwordError)
			.withSuccessHandler(new_passwordOk)
			.executereset(_params); 
            }
            else
            {
            			toastboxOpen("2011"); 
            }
           } else {
             toastboxOpen("2006"); 
           }
		} else {
			toastboxOpen("1000"); 
		} 
	} else {
		toastboxOpen("1");
	}
}
function new_passwordError(data){
  progressboxClose();
  toastboxOpen("2000");
}
function new_passwordOk(data){
    progressboxClose();
    
	if (data.result.code == 3000) {
       resetPasswordClose();
       document.getElementById("idResetPasswordStep1").style.display='block';
       document.getElementById("idResetPasswordStep3").style.display='none';
       setTimeout(toastboxOpen("3003"),2000); 
    } else { 
         resetPasswordClose();
       document.getElementById("idResetPasswordStep1").style.display='block';
       document.getElementById("idResetPasswordStep3").style.display='none';
       setTimeout(toastboxOpen("2005"),2000);
    }
    
}
function ihaveerror(err)
{
alert(err)
}
</script>
<style>
.disabledtag{
    pointer-events:none;
    opacity:0.4;
}
</style>
